version: 2

jobs:
  build:
    docker:
      - image: ubuntu:16.04
    
    steps:
      - checkout
      - run:
          name: preparation
          command: |
            apt-get update
            apt-get install -y curl wget build-essential libcurl4-openssl-dev libelf-dev libdw-dev binutils-dev cmake libiberty-dev pkg-config zlib1g-dev
            wget "https://static.rust-lang.org/rustup/dist/x86_64-unknown-linux-gnu/rustup-init"
            chmod +x rustup-init
            ./rustup-init -y --no-modify-path --default-toolchain nightly
            RUSTUP=~/.cargo/bin/rustup
            CARGO=~/.cargo/bin/cargo
            chmod -R a+w $RUSTUP $CARGO
            rm rustup-init
      - run:
          name: test3
          command: |
            source ~/.cargo/env
            export PATH=~/.cargo/bin:$PATH
            cargo test test3 -- --nocapture

